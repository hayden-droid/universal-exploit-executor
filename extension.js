const vscode = require("vscode")

const execute_button = vscode.window.createStatusBarItem(vscode.StatusBarAlignment.Left)
let exploit = null

execute_button.text = `$(notebook-execute) ${exploit} Execute`
execute_button.tooltip = "Execute Script"
execute_button.command = "universal-exploit-executor.exploitExecute"

// start websocket server

let web_socket_server = new require("ws").Server
web_socket_server = new web_socket_server({port: 41738})

web_socket_server.on("connection", function(websocket) {
	execute_button.show()

	websocket.on("message", function(message) {
		console.log("recieved: %s", message.toString())
	})

	websocket.on("close", function() {
		execute_button.hide()
	})
})

function activate(context) {
	let disposable = vscode.commands.registerCommand("universal-exploit-executor.exploitExecute", function () {
		const content = vscode.window.activeTextEditor.document.getText()

		vscode.window.showInformationMessage("Button Clicked")
	})

	context.subscriptions.push(disposable)
}

// this method is called when your extension is deactivated
function deactivate() {
	execute_button.dispose()
}

module.exports = {
	activate,
	deactivate
}